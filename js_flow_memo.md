# 初心者向け: JavaScript処理フロー解説メモ (`script.js`)

このドキュメントでは、アプリの「動き」を担当している `script.js` の中身を、初心者の方向けにブロックごとに分けて解説します。

## 1. 準備ブロック (Setup)
プログラムが動き出す前に、必要な道具（HTMLの部品）やメモ帳（変数）を用意する場所です。

-   **DOM要素の取得**: `document.getElementById` を使って、HTMLにある「入力欄」や「ボタン」をJavaScriptで操作できるように変数に入れます。
-   **状態管理（State）**: 今どの週を表示しているか（`currentWeekOffset`）や、カレンダーのデータ（`cachedHistoryData`）など、アプリ全体で覚えておくべき情報を変数として定義します。

## 2. データの取得と表示ブロック (Fetch & Render)
アプリが開かれたときや、更新が必要なときに動くメインの処理です。

1.  **`fetchRoutines()`**: 「サーバーさん、今の週のデータください！」とお願い（APIリクエスト）をする関数です。
    -   データが返ってきたら、画面を描画する関数 (`render...`) にパスします。
2.  **`renderWeekHeader(weekDates)`**: 受け取った日付データを使って、画面上部の「日付（10/24 Mon...）」を表示します。
3.  **`renderRoutines(routines, ...)`**: 受け取ったルーチン（タスク）のリストを画面に並べます。
    -   ここで `<li>` タグなどをJavaScriptで作って、HTMLのリストに追加しています。
    -   タスク名やチェックボックスもここで作られます。

## 3. ユーザー操作への反応ブロック (User Actions)
ボタンが押されたり、入力されたりしたときに動く関数たちです。

-   **`addRoutine()`**: 「Add」ボタンが押されたら動きます。
    -   入力欄の文字を見て、サーバーに「新しいタスク作って！」と送信 (`POST`) します。
    -   成功したら、入力欄を空にして、リストを再読み込み (`fetchRoutines`) します。
-   **`editRoutine(id, title)`**: タスク名がクリックされたら動きます。
    -   `prompt` で新しい名前を入力させ、サーバーに「名前変更して！」と送信 (`PUT`) します。
-   **`deleteRoutine(id)`**: ゴミ箱ボタンが押されたら動きます。
    -   サーバーに「これ消して！」と送信 (`DELETE`) します。
-   **`toggleDay(id, date)`**: 日付の丸（チェックボックス）がクリックされたら動きます。
    -   サーバーに「完了/未完了を切り替えて！」と送信 (`POST`) します。

## 4. 便利機能ブロック (Helpers)
日付の表示を変えたり、ちょっとした計算をする裏方さんです。

-   **`formatrangeDate(dateStr)`**: `2025-12-07` みたいな文字を `2025/12/07` のように見やすく整えます。
-   **`changeWeek(delta)`**: 「＜」「＞」ボタンで週を移動するときに使います。現在の週番号を足したり引いたりして、データを再取得します。

## 5. 履歴カレンダーブロック (History Modal)
画面いっぱいに広がる履歴画面（モーダル）の処理です。

-   **`openGlobalHistory()`**: ボタンが押されたら、過去の全データをサーバーから取ってきます。
-   **`renderCalendar()`**: 取ってきたデータを元に、四角いカレンダーのマス目を作ります。
    -   タスクがある日は色を付けたり (`completed` クラス)、クリックできるようにしたりします。
-   **`selectDate(dateStr)`**: カレンダーの日付をクリックしたときに動きます。
    -   その日に完了したタスクだけをリストアップして表示します。

---

### 全体の流れまとめ
1.  **起動**: ページが開かれると、まず `fetchRoutines()` が呼ばれます。
2.  **表示**: データが届くと `render...` 系が動いて画面が作られます。
3.  **待機**: ユーザーがボタンを押すのを待ちます。
4.  **反応**: ボタンが押されると `addRoutine` などが動き、サーバーと通信して、また `fetchRoutines()` で画面を最新にします。
